import{k as z,l as E,q as m,r as d}from"./chunk-JQYX7GE2.js";import{$a as $,Da as M,Ia as _,J as f,P as n,Pa as b,Ra as a,Sa as c,U as s,Va as F,Za as i,_a as T,ba as j,f as x,l as A,m as w,q as H,s as S,ta as l,ua as O,y as k,z as P}from"./chunk-QCMIUKNS.js";var u=class t{constructor(e){this.http=e}getAccessToken(){return this.http.get("https://mm-913.onrender.com/api/token")}static \u0275fac=function(o){return new(o||t)(s(d))};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})};var v=class t{constructor(e,o){this.http=e;this.authService=o}getAuthenticatedHeaders(){return this.authService.getAccessToken().pipe(f(e=>{let o=new m({Authorization:`Bearer ${e.access_token}`});return new x(r=>{r.next(o),r.complete()})}))}static \u0275fac=function(o){return new(o||t)(s(d),s(u))};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})};var g=class t extends v{baseUrl="https://eu.api.blizzard.com";getFull3v3Ladder(){let o="eu";return this.authService.getAccessToken().pipe(f(r=>{let h=new m({Authorization:`Bearer ${r.access_token}`}),L=Array.from({length:5},(p,I)=>I+1);return A(L).pipe(S(p=>this.http.get(`https://${o}.api.blizzard.com/data/wow/pvp-season/11/pvp-leaderboard/3v3?page=${p}&namespace=dynamic-classic-${o}&locale=en_GB`,{headers:h}).pipe(k(()=>w({entries:[]})))),P(),H(p=>p.flatMap(C=>C.entries||[]).filter((C,W,D)=>D.findIndex(N=>N.character?.id===C.character?.id)===W)))}))}static \u0275fac=(()=>{let e;return function(r){return(e||(e=j(t)))(r||t)}})();static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})};function U(t,e){if(t&1&&(a(0,"div",2)(1,"h2"),i(2,"Season 11 Gladiator Cutoff"),c(),a(3,"p"),i(4),c(),a(5,"p"),i(6,"Current Cutoff: "),a(7,"strong"),i(8),c(),i(9," Rating"),c()()),t&2){let o=F();l(4),$("Total Players: ",o.totalPlayers,""),l(4),T(o.gladiatorCutoff)}}function J(t,e){t&1&&(a(0,"div")(1,"p"),i(2,"Loading cutoff data or API unavailable..."),c()())}var B=class t{constructor(e){this.wowApi=e}gladiatorCutoff=null;totalPlayers=0;ngOnInit(){this.wowApi.getFull3v3Ladder().subscribe({next:e=>{this.totalPlayers=e.length,e.sort((r,h)=>h.rating-r.rating);let o=Math.floor(this.totalPlayers*.005);this.gladiatorCutoff=e[o]?.rating??null,console.log(`Cutoff determined from ${this.totalPlayers} players`)},error:e=>{console.error("Leaderboard fetch failed",e)}})}static \u0275fac=function(o){return new(o||t)(O(g))};static \u0275cmp=M({type:t,selectors:[["app-cutoffs"]],decls:2,vars:2,consts:[["class","cutoff-container",4,"ngIf"],[4,"ngIf"],[1,"cutoff-container"]],template:function(o,r){o&1&&_(0,U,10,2,"div",0)(1,J,3,0,"div",1),o&2&&(b("ngIf",r.gladiatorCutoff!==null),l(),b("ngIf",r.gladiatorCutoff===null))},dependencies:[E,z],styles:[".cutoff-container[_ngcontent-%COMP%]{background-color:#1e1e1e;padding:16px;border-radius:8px;color:#fff}"]})};export{B as CutoffsComponent};
