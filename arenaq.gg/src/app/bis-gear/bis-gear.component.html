<section class="bis-gear-container">
  <header class="gear-header">
    <div>
      <h1>Most Popular Gear</h1>
      <p class="subtitle">
        Explore the top three items most frequently equipped by high-rated 3v3 players for each class.
        Select a class icon to inspect its best-in-slot choices.
      </p>
    </div>
  </header>

  <div class="class-selector">
    @for (option of classOptions; track option.slug) {
      <button
        type="button"
        class="class-chip"
        [class.active]="(selectedClass$ | async) === option.slug"
        (click)="onSelectClass(option.slug)"
      >
        <img
          class="class-icon"
          [src]="getClassIcon(option.slug)"
          [alt]="option.name"
          loading="lazy"
          (error)="onIconError($event)"
        />
        <span>{{ option.name }}</span>
      </button>
    }
  </div>

  @if (error) {
    <div class="status error">{{ error }}</div>
  }

  @if (!error) {
    @if (vm$ | async; as vm) {
      <div class="table-meta">
        <span class="pill">{{ vm.className }}</span>
        <span class="pill">Samples · {{ vm.totalSamples }}</span>
        <span class="pill">Region · {{ vm.regionLabel }}</span>
        @if (vm.generatedAt) {
          <span class="timestamp">Updated {{ vm.generatedAt | date: 'medium' }}</span>
        }
      </div>

      @if (vm.items.length) {
        <div class="table-wrapper" tabindex="0">
          <table class="gear-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Item</th>
                <th>Slot</th>
                <th>Usage</th>
              </tr>
            </thead>
            <tbody>
            @for (entry of vm.items; track trackItem(entry); let i = $index) {
                <tr>
                  <td class="rank">#{{ i + 1 }}</td>
                  <td class="item-name">{{ entry.item }}</td>
                  <td>{{ entry.slot }}</td>
                  <td class="usage-cell">
                    <div class="usage-bar">
                      <div class="usage-fill" [style.width.%]="entry.percent"></div>
                    </div>
                    <span class="usage-label">
                      {{ formatPercent(entry.percent) }} · {{ entry.count }} players
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <div class="status empty">No gear data available for this class yet.</div>
      }
    } @else {
      <div class="status">Loading gear snapshot...</div>
    }
  }
</section>
